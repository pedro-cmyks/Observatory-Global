# Observatory Global - Environment Variables
# Copy this file to .env and fill in your actual values

# ============================================================================
# Backend Configuration
# ============================================================================

# FastAPI Environment
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
APP_PORT=8000
API_BASE_URL=http://localhost:8000

# CORS Settings
CORS_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_CREDENTIALS=true

# ============================================================================
# Database Configuration
# ============================================================================

# PostgreSQL
DATABASE_URL=postgresql://observatory:changeme@postgres:5432/observatory
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=observatory
POSTGRES_USER=observatory
POSTGRES_PASSWORD=changeme

# Redis Cache
REDIS_URL=redis://redis:6379/0
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_TTL_SECONDS=86400  # 24 hours

# ============================================================================
# External Data Sources
# ============================================================================

# GDELT 2.0
GDELT_BASE=http://data.gdeltproject.org/gdeltv2
GDELT_ENDPOINT=https://api.gdeltproject.org/api/v2/doc/doc
GDELT_TIMEOUT_SECONDS=30
GDELT_MAX_RECORDS=250

# Google Trends (pytrends)
GOOGLE_TRENDS_TIMEOUT_SECONDS=30
GOOGLE_TRENDS_COOKIES_PATH=/app/cookies/google_trends.json
GOOGLE_TRENDS_QUOTA_LIMIT=400  # requests per hour
GOOGLE_TRENDS_BACKOFF_ENABLED=true

# Wikipedia Pageviews API
WIKI_API_ENDPOINT=https://wikimedia.org/api/rest_v1/metrics/pageviews/top
WIKI_USER_AGENT=ObservatoryGlobal/1.0 (https://github.com/pedro-cmyks/Observatory-Global; pedrovillegascsj@gmail.com)
WIKI_TIMEOUT_SECONDS=30

# ============================================================================
# Data Processing & NLP
# ============================================================================

# Refresh Intervals (see ADR-0001)
REFRESH_INTERVAL_SECONDS=900  # 15 minutes
REFRESH_CRON=*/15 * * * *
WIKIPEDIA_REFRESH_INTERVAL_SECONDS=3600  # 1 hour
ADAPTIVE_BACKOFF_ENABLED=true

# Heat Formula (see ADR-0002)
HEAT_HALFLIFE_HOURS=6
FLOW_THRESHOLD=0.5
SIMILARITY_METHOD=tfidf  # tfidf, bert (future)
SIMILARITY_CACHE_TTL_SECONDS=900  # 15 minutes

# NLP Processing
USE_CACHE=true
DRY_RUN_APIS=false
NLP_CLUSTERING_MIN_CLUSTERS=1
NLP_CLUSTERING_MAX_CLUSTERS=10
TOPIC_MIN_LENGTH=3
TOPIC_MAX_LENGTH=100

# Hotspot Intensity Weights (see ADR-0002)
INTENSITY_VOLUME_WEIGHT=0.4
INTENSITY_VELOCITY_WEIGHT=0.3
INTENSITY_CONFIDENCE_WEIGHT=0.3

# ============================================================================
# Frontend Configuration
# ============================================================================

# Vite + React
VITE_API_URL=http://localhost:8000
VITE_API_BASE_URL=http://localhost:8000
VITE_MAPBOX_TOKEN=pk.eyJ1IjoicHZpbGxlZyIsImEiOiJjbWh3Nnptb28wNDB2Mm9weTFqdXZqM3VyIn0.ZnybOXNNDKL1HJFuklpyGg
MAPBOX_TOKEN=pk.eyJ1IjoicHZpbGxlZyIsImEiOiJjbWh3Nnptb28wNDB2Mm9weTFqdXZqM3VyIn0.ZnybOXNNDKL1HJFuklpyGg
VITE_DEFAULT_REFRESH_MS=300000  # 5 minutes
VITE_ENABLE_DEBUG=true

# Map Configuration
VITE_MAP_DEFAULT_CENTER_LAT=20
VITE_MAP_DEFAULT_CENTER_LNG=0
VITE_MAP_DEFAULT_ZOOM=2
VITE_MAP_STYLE=mapbox://styles/mapbox/dark-v11

# ============================================================================
# Feature Flags
# ============================================================================

FEATURE_FLOWS_API=true
FEATURE_HISTORICAL_ARCHIVE=true
FEATURE_REAL_TIME_UPDATES=false  # WebSocket support (future)
FEATURE_SENTIMENT_ANALYSIS=false  # Future
FEATURE_MULTI_LANGUAGE=false  # Future

# ============================================================================
# Monitoring & Observability (Optional)
# ============================================================================

# Logging
STRUCTURED_LOGGING=true
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/observatory/app.log

# Metrics (Prometheus - future)
ENABLE_METRICS=false
METRICS_PORT=9090

# Tracing (OpenTelemetry - future)
ENABLE_TRACING=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4318

# ============================================================================
# Development & Testing
# ============================================================================

# Testing
TEST_DATABASE_URL=postgresql://test:test@localhost:5433/test
PYTEST_TIMEOUT=300
COVERAGE_THRESHOLD=80

# Development
APP_ENV=development
HOT_RELOAD=true
PRETTY_ERRORS=true

# ============================================================================
# Docker Compose Services
# ============================================================================

# Container Names
COMPOSE_PROJECT_NAME=observatory-global

# Service Ports (for local development)
FRONTEND_PORT=5173
BACKEND_PORT=8000
POSTGRES_PORT_EXTERNAL=5432
REDIS_PORT_EXTERNAL=6379

# ============================================================================
# Cloud Deployment (Google Cloud Run)
# ============================================================================

# GCP Project
GCP_PROJECT_ID=your-gcp-project-id
GCP_REGION=us-central1

# Cloud SQL
CLOUD_SQL_CONNECTION_NAME=your-project:region:instance

# Cloud Run
CLOUD_RUN_SERVICE_ACCOUNT=observatory-sa@your-project.iam.gserviceaccount.com
CLOUD_RUN_MAX_INSTANCES=10
CLOUD_RUN_MIN_INSTANCES=1
CLOUD_RUN_MEMORY=2Gi
CLOUD_RUN_CPU=2

# ============================================================================
# Security (Production Only)
# ============================================================================

# API Keys (rotate regularly)
API_SECRET_KEY=change-me-in-production-use-32-char-random-string
JWT_SECRET_KEY=change-me-in-production-use-32-char-random-string
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# ============================================================================
# Notes
# ============================================================================

# 1. Never commit the actual .env file to version control
# 2. Update this .env.example whenever adding new environment variables
# 3. Document any non-obvious variables with inline comments
# 4. Keep production secrets in a secure vault (GCP Secret Manager, etc.)
# 5. See docs/decisions/ for ADRs explaining configuration choices
